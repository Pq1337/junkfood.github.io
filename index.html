<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JF1337</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet" />
  <link rel="icon" href="icon.ico" type="image/png" />
</head>

<body>
  <audio id="bg-music" preload="metadata"></audio>

  <button id="music-btn" class="music-btn is-off" type="button" aria-label="toggle music">
    <span class="label label-on">Music: ON</span>
    <span class="label label-off">Music: OFF</span>
  </button>

  
  <div class="music-controls" id="music-controls">
    <div class="now-playing" id="nowPlaying">Now Playing: -</div>

    <div class="row mini-row">
      <button id="prevBtn" class="mini-btn" type="button" aria-label="previous track">â®</button>
      <button id="playBtn" class="mini-btn" type="button" aria-label="play/pause">â–¶</button>
      <button id="nextBtn" class="mini-btn" type="button" aria-label="next track">â­</button>

      <button id="shuffleBtn" class="mini-btn toggle on" type="button" aria-label="shuffle">ğŸ”€</button>
      <button id="repeatBtn" class="mini-btn toggle" type="button" aria-label="repeat">ğŸ”</button>
    </div>

    <div class="row">
      <span id="curTime">0:00</span>
      <input id="progress" type="range" min="0" max="100" value="0" step="0.1" aria-label="music progress" />
      <span id="durTime">0:00</span>
    </div>

    <div class="row volume-row">
      <span>ğŸ”ˆ</span>
      <input id="volume" type="range" min="0" max="1" value="1" step="0.01" aria-label="volume" />
      <span>ğŸ”Š</span>
    </div>
  </div>

  <video id="background-video" autoplay muted loop playsinline>
    <source src="wallpaper1.mp4" type="video/mp4" />
  </video>
  <div class="card">
    <img src="avatar.png" class="avatar" alt="Avatar" />

    <h1 class="title">Welcome to ã‚¸ãƒ£ãƒ³ã‚¯ãƒ•ãƒ¼ãƒ‰1337's official website</h1>
    <h2 class="subtitle">I'll introduce myself?</h2>

    <h2 class="introduction">ğŸ‘¤ About Me</h2>

    <h3 class="section-title">1. Hobbies</h3>
    <p class="section-text">hobbies? Nah, I just wanna lie on my cozy bed.</p>

    <h3 class="section-title">2. Skills</h3>
    <p class="section-text">I can play a nice HvH game on my dogshit laptop with 30 FPS?</p>

    <h3 class="section-title">3. Motto</h3>
    <p class="del-one">Eat junk food, stay up late, and cheat in games.</p>
    <p class="section-text">Trust in urself, u are the best!</p>

    <h2 class="section-title">ğŸ“¬ Contact</h2>

    <div class="contact-grid">
      <div class="contact-box">
        <span class="contact-label">QQ:</span>
        <span class="contact-value">2073095729</span>
      </div>

      <div class="contact-box">
        <span class="contact-label">Email:</span>
        <span class="contact-value">yzxdsb123@gmail.com</span>
      </div>

      <div class="contact-box">
        <span class="contact-label">Discord:</span>
        <span class="contact-value">yyyuuu_38459</span>
      </div>
    </div>
    <div class="extra-section">
      <button id="fmi-btn" class="fmi-btn" type="button">
        For More Information
        <span class="arrow">â–¼</span>
      </button>
      <div id="extra-content" class="extra-content" aria-hidden="true">
        <a class="BL"
           href="https://space.bilibili.com/391436861/upload/video"
           target="_blank"
           rel="noopener noreferrer">
          Click here to visit my Bilibili channel
        </a>
      </div>
    </div>
  </div>
  <div id="subtitleBox" class="subtitle-box hidden">
    <span id="subtitleText"></span>
  </div>

  <footer class="footer">
    Â© <span id="year"></span> JF1337
  </footer>

  <script>
    const music = document.getElementById("bg-music");

    // Top button (original) + small transport controls
    const bigBtn = document.getElementById("music-btn");
    const prevBtn = document.getElementById("prevBtn");
    const playBtn = document.getElementById("playBtn");
    const nextBtn = document.getElementById("nextBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const repeatBtn = document.getElementById("repeatBtn");
    const nowPlaying = document.getElementById("nowPlaying");

    const subtitleBox = document.getElementById("subtitleBox");
    const subtitleText = document.getElementById("subtitleText");

    const progress = document.getElementById("progress");
    const volume = document.getElementById("volume");
    const curTime = document.getElementById("curTime");
    const durTime = document.getElementById("durTime");

    const fmiBtn = document.getElementById("fmi-btn");
    const extraContent = document.getElementById("extra-content");
    const arrow = document.querySelector(".arrow");

    document.getElementById("year").textContent = new Date().getFullYear();

    // ---------- Playlist ----------
    const playlist = [
      {
        title: "Si Tu Vois Ma MÃ¨re",
        src: "music disk.flac",
        subs: [
          { start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "Music brings the page to life." },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
      // ä½ å¯ä»¥è‡ªå·±åŠ æ›´å¤šæ­Œï¼ˆæª”åè¦æ”¾åœ¨åŒè³‡æ–™å¤¾ï¼‰
      { title: "AnRainå®‰æ— - æ˜Ÿæ²³ä¸åŠä½ ", src: "music3.ogg", subs:
       [{ start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "Do ya like soft music?" },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
      { title: "Wthegg - Wingsï¼You Are My Future", src: "music4.ogg", subs: 
      [{ start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "Best one" },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
      { title: "ä¸‰è‘‰ã®ãƒ†ãƒ¼ãƒ", src: "music1.flac", subs: [
        { start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "I can't make it up......" },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
      { title: "æ‹ã‹ã‚‚ã—ã‚Œãªã„ä½•ã‹ã®è©±", src: "music2.flac", subs: [
        { start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "Soft music let us think more" },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
      { title: "æ¾ç”°å½¬äºº - ã“ã‚ŒãŒåƒ•ã‚‰ã®æ—¥å¸¸", src: "music5.flac", subs: [
        { start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "Soft music ofc better then HipHop" },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
      { title: "ã•ã‚“ã†ã•ã - ä¸–ç•Œã¯ç§ã®ãŸã‚ã ã‘ã«", src: "music6.ogg", subs: [
        { start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©çš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³" },
          { start: 4.5, end: 9.0, text: "Soft music is the best" },
          { start: 9.0, end: 14.0, text: "Enjoy :P" },
        ],
      },
    ];

    let isPlaying = false;
    let isSeeking = false;

    // shuffle / repeat
    let shuffleOn = true;     // é è¨­é–‹å•Ÿéš¨æ©Ÿ
    // repeatMode: 0=off, 1=repeat all, 2=repeat one
    let repeatMode = 0;

    let currentIndex = 0;
    let shuffleBag = []; // ç”¨ã€ŒæŠ½ç‰Œè¢‹ã€é¿å…çŸ­æ™‚é–“é‡è¤‡

    // subtitles
    let currentSubs = playlist[0].subs;
    let lastLine = "";

    function fmt(t) {
      if (!isFinite(t)) return "0:00";
      const m = Math.floor(t / 60);
      const s = Math.floor(t % 60);
      return `${m}:${String(s).padStart(2, "0")}`;
    }

    function setSubtitleSmooth(text) {
      if (text === lastLine) return;
      lastLine = text;

      subtitleText.classList.add("fading");
      setTimeout(() => {
        subtitleText.textContent = text;
        subtitleText.classList.remove("fading");
      }, 180);
    }

    function updateSubtitle(time) {
      const line = currentSubs.find(s => time >= s.start && time < s.end);
      if (line) {
        subtitleBox.classList.remove("hidden");
        setSubtitleSmooth(line.text);
      } else {
        subtitleBox.classList.add("hidden");
        lastLine = "";
      }
    }

    function fadeTo(target, duration = 500) {
      const start = music.volume;
      const startTime = performance.now();
      target = Math.max(0, Math.min(1, target));

      function tick(now) {
        const t = Math.min(1, (now - startTime) / duration);
        music.volume = start + (target - start) * t;
        if (t < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function refillShuffleBag() {
      shuffleBag = [...Array(playlist.length).keys()];
      shuffleArray(shuffleBag);

      // é¿å…ä¸‹ä¸€é¦–å‰›å¥½ç­‰æ–¼ç›®å‰é€™é¦–ï¼ˆå¦‚æœæ­Œæ›²>1é¦–ï¼‰
      if (playlist.length > 1 && shuffleBag[0] === currentIndex) {
        const k = shuffleBag.findIndex(x => x !== currentIndex);
        if (k > 0) [shuffleBag[0], shuffleBag[k]] = [shuffleBag[k], shuffleBag[0]];
      }
    }

    function pickNextIndex(direction = +1) {
      if (shuffleOn) {
        if (shuffleBag.length === 0) refillShuffleBag();
        const next = shuffleBag.shift();
        return next;
      }
      // ééš¨æ©Ÿï¼šé †åºä¸Šä¸€é¦–/ä¸‹ä¸€é¦–
      const n = playlist.length;
      return (currentIndex + direction + n) % n;
    }

    async function loadTrack(index, { autoplay = false, keepTime = false } = {}) {
      if (index < 0 || index >= playlist.length) return;

      // æ¸…å­—å¹•
      subtitleBox.classList.add("hidden");
      lastLine = "";

      const prevTime = music.currentTime || 0;
      currentIndex = index;

      const track = playlist[currentIndex];
      currentSubs = track.subs || [];

      nowPlaying.textContent = `Now Playing: ${track.title}`;

      // å…ˆæ·¡å‡ºå†æ›æ­Œæ›´èˆ’æœ
      const targetVol = Number(volume.value);
      if (isPlaying) fadeTo(0, 220);

      // ç­‰æ·¡å‡ºä¸€ä¸‹
      await new Promise(r => setTimeout(r, isPlaying ? 240 : 0));

      music.src = track.src;
      music.load();

      // metadata è®€åˆ°å¾Œæœƒæ›´æ–° durTime
      if (keepTime) {
        music.addEventListener("loadedmetadata", () => {
          music.currentTime = Math.min(prevTime, music.duration || prevTime);
        }, { once: true });
      }

      if (autoplay) {
        try {
          await music.play();
          isPlaying = true;
          syncUIPlaying(true);
          fadeTo(targetVol, 320);
        } catch (e) {
          console.log("Play blocked:", e);
          isPlaying = false;
          syncUIPlaying(false);
        }
      } else {
        // ä¸è‡ªå‹•æ’­å°±é¡¯ç¤ºæ’­æ”¾éµ
        syncUIPlaying(false);
      }
    }

    function syncUIPlaying(on) {
      if (on) {
        bigBtn.classList.remove("is-off");
        bigBtn.classList.add("is-on");
        playBtn.textContent = "â¸";
      } else {
        bigBtn.classList.remove("is-on");
        bigBtn.classList.add("is-off");
        playBtn.textContent = "â–¶";
      }
    }

    function syncShuffleUI() {
      shuffleBtn.classList.toggle("on", shuffleOn);
    }

    function syncRepeatUI() {
      // 0=off 1=all 2=one
      repeatBtn.classList.toggle("on", repeatMode !== 0);
      repeatBtn.textContent = repeatMode === 2 ? "ğŸ”‚" : "ğŸ”";
    }

// ---------- Volume (save) ----------
    const savedVol = localStorage.getItem("vol");
    if (savedVol !== null) {
      volume.value = savedVol;
      music.volume = Number(savedVol);
    } else {
      music.volume = Number(volume.value);
    }

    volume.addEventListener("input", () => {
      const v = Number(volume.value);
      music.volume = v;
      localStorage.setItem("vol", String(v));
    });

    // ---------- Progress ----------
    music.addEventListener("loadedmetadata", () => {
      durTime.textContent = fmt(music.duration);
      if (!isSeeking) progress.value = 0;
      curTime.textContent = fmt(music.currentTime);
    });

    progress.addEventListener("input", () => {
      if (!music.duration) return;
      isSeeking = true;
      const t = (Number(progress.value) / 100) * music.duration;
      curTime.textContent = fmt(t);
    });

    progress.addEventListener("change", () => {
      if (!music.duration) return;
      const t = (Number(progress.value) / 100) * music.duration;
      music.currentTime = t;
      isSeeking = false;
      if (isPlaying) updateSubtitle(music.currentTime);
    });

    music.addEventListener("timeupdate", () => {
      if (isPlaying) updateSubtitle(music.currentTime);
      if (!music.duration) return;

      if (!isSeeking) {
        const p = (music.currentTime / music.duration) * 100;
        progress.value = p;
      }
      curTime.textContent = fmt(music.currentTime);
    });

    async function playOrPause() {
      try {
        if (!music.src) {
          // ç¬¬ä¸€æ¬¡æ’­æ”¾ï¼šä¾ç…§ shuffle/é †åºé¸æ­Œ
          if (shuffleOn) refillShuffleBag();
          const first = shuffleOn ? pickNextIndex(+1) : 0;
          await loadTrack(first, { autoplay: true });
          return;
        }

        if (!isPlaying) {
          await music.play();
          isPlaying = true;
          syncUIPlaying(true);
          fadeTo(Number(volume.value), 260);
        } else {
          isPlaying = false;
          syncUIPlaying(false);
          fadeTo(0, 220);
          setTimeout(() => music.pause(), 240);
          subtitleBox.classList.add("hidden");
        }
      } catch (e) {
        console.log("Play blocked:", e);
      }
    }

    async function nextTrack() {
      const next = repeatMode === 2 ? currentIndex : pickNextIndex(+1);
      await loadTrack(next, { autoplay: isPlaying });
    }

    async function prevTrack() {
      if (music.currentTime > 3 && !shuffleOn) {
        music.currentTime = 0;
        return;
      }
      const prev = pickNextIndex(-1);
      await loadTrack(prev, { autoplay: isPlaying });
    }

    music.addEventListener("ended", async () => {
      if (repeatMode === 2) {
        await loadTrack(currentIndex, { autoplay: true });
        return;
      }

      if (repeatMode === 0 && !shuffleOn) {
        if (currentIndex === playlist.length - 1) {
          isPlaying = false;
          syncUIPlaying(false);
          subtitleBox.classList.add("hidden");
          progress.value = 0;
          curTime.textContent = "0:00";
          return;
        }
      }

      const next = pickNextIndex(+1);
      await loadTrack(next, { autoplay: true });
    });

    // ---------- Buttons ----------
    bigBtn.addEventListener("click", playOrPause);
    playBtn.addEventListener("click", playOrPause);
    nextBtn.addEventListener("click", nextTrack);
    prevBtn.addEventListener("click", prevTrack);

    shuffleBtn.addEventListener("click", () => {
      shuffleOn = !shuffleOn;
      if (shuffleOn) refillShuffleBag();
      syncShuffleUI();
    });

    repeatBtn.addEventListener("click", () => {
      repeatMode = (repeatMode + 1) % 3;
      syncRepeatUI();
    });

    // åˆå§‹ UI
    syncUIPlaying(false);
    syncShuffleUI();
    syncRepeatUI();
    nowPlaying.textContent = "Now Playing: -";

    // ---------- Expand section ----------
    extraContent.style.maxHeight = "0";
    extraContent.setAttribute("aria-hidden", "true");

    fmiBtn.addEventListener("click", () => {
      extraContent.classList.toggle("show");
      arrow.classList.toggle("rotate");

      if (extraContent.classList.contains("show")) {
        extraContent.style.maxHeight = extraContent.scrollHeight + "px";
        extraContent.setAttribute("aria-hidden", "false");
      } else {
        extraContent.style.maxHeight = "0";
        extraContent.setAttribute("aria-hidden", "true");
      }
    });
  </script>

</body>
</html>

