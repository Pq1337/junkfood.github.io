<!DOCTYPE html>
<html>
<head>
    <title>JF1337</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap" rel="stylesheet">
    <link rel="icon" href="icon.ico" type="image/png">
</head>

<body>

<audio id="bg-music" loop preload="metadata">
    <!-- ä½ åŽŸæœ¬æ˜¯ flacï¼Œtype å»ºè­°å¯« audio/flac -->
    <source src="music disk.flac" type="audio/flac">
</audio>

<button id="music-btn" class="music-btn is-off">
    <span class="label label-on">Music: ON</span>
    <span class="label label-off">Music: OFF</span>
</button>

<!-- âœ… æ–°å¢žï¼šé€²åº¦æ¢ + éŸ³é‡æ¢ -->
<div class="music-controls" id="music-controls">
    <div class="row">
        <span id="curTime">0:00</span>
        <input id="progress" type="range" min="0" max="100" value="0" step="0.1" aria-label="music progress">
        <span id="durTime">0:00</span>
    </div>

    <div class="row volume-row">
        <span>ðŸ”ˆ</span>
        <input id="volume" type="range" min="0" max="1" value="1" step="0.01" aria-label="volume">
        <span>ðŸ”Š</span>
    </div>
</div>

<video id="background-video" autoplay muted loop playsinline>
    <source src="wallpaper1.mp4" type="video/mp4">
</video>

<div class="card">
    <img src="avatar.png" class="avatar" alt="Avatar">
    <h1 class="title">Here is the JF1337 official website</h1>
    <p>Wanna Best Gaming Experience?</p>
    <p>These three things are all you need!</p>

    <ol class="brand-list">
        <li>Game<span class="green">Sense</span></li>
        <li>Never<span class="blue">Lose</span></li>
        <li><span class="red">Fatality</span></li>
    </ol>

    <p>These are the best cheats for CS2.</p>

    <div class="menu">
        <a class="main-btn" href="#" onclick="return false;">For more information?</a>

        <div class="sub-btns">
            <a class="sub-btn gs" href="https://gamesense.pub" target="_blank">GameSense</a>
            <a class="sub-btn nl" href="https://Neverlose.cc" target="_blank">Neverlose</a>
            <a class="sub-btn fa" href="https://fatality.win" target="_blank">Fatality</a>
        </div>
    </div>
</div>

<div id="subtitleBox" class="subtitle-box hidden">
    <span id="subtitleText"></span>
</div>

<footer class="footer">
    Â© <span id="year"></span> JF1337
</footer>

<script>
document.getElementById("year").textContent =
    new Date().getFullYear();

const music = document.getElementById("bg-music");
const btn = document.getElementById("music-btn");

const subtitleBox = document.getElementById("subtitleBox");
const subtitleText = document.getElementById("subtitleText");

const progress = document.getElementById("progress");
const volume = document.getElementById("volume");
const curTime = document.getElementById("curTime");
const durTime = document.getElementById("durTime");

let isPlaying = false;
let lastLine = "";
let isSeeking = false;

// ä½ çš„å­—å¹•
const subs = [
    { start: 0.0, end: 4.5, text: "æ­¤æ­Œæ›²ç‚ºæ²’æœ‰å¡«è©žçš„ç´”éŸ³æ¨‚ï¼Œè«‹æ‚¨æ¬£è³ž" },
    { start: 4.5, end: 9.0, text: "Music brings the page to life." },
    { start: 9.0, end: 195.0, text: "Enjoy :P" },
];

// æ™‚é–“æ ¼å¼
function fmt(t){
    if(!isFinite(t)) return "0:00";
    const m = Math.floor(t / 60);
    const s = Math.floor(t % 60);
    return `${m}:${String(s).padStart(2, "0")}`;
}

function setSubtitleSmooth(text){
    if(text === lastLine) return;
    lastLine = text;

    subtitleText.classList.add("fading");
    setTimeout(() => {
        subtitleText.textContent = text;
        subtitleText.classList.remove("fading");
    }, 180);
}

function updateSubtitle(time){
    const line = subs.find(s => time >= s.start && time < s.end);
    if(line){
        subtitleBox.classList.remove("hidden");
        setSubtitleSmooth(line.text);
    }else{
        subtitleBox.classList.add("hidden");
        lastLine = "";
    }
}

// âœ… metadata è¼‰å…¥å¾Œé¡¯ç¤ºç¸½é•·åº¦
music.addEventListener("loadedmetadata", () => {
    durTime.textContent = fmt(music.duration);
});

// âœ… éŸ³é‡æ¢æŽ§åˆ¶ï¼ˆä¿ç•™ä½ çš„ fadeIn/fadeOutï¼Œä½†éŸ³é‡æ¢æœƒèª¿æ•´ã€Œç›®æ¨™éŸ³é‡ã€ï¼‰
volume.addEventListener("input", () => {
    // ç•¶æ­£åœ¨æ’­æ”¾æ™‚ï¼Œç›´æŽ¥æ”¹ç•¶å‰éŸ³é‡
    // ç•¶é‚„æ²’æ’­æ”¾ï¼Œå…ˆå­˜è‘—ï¼ŒæŒ‰ä¸‹æ’­æ”¾å¾Œ fadeIn æœƒæ·¡å…¥åˆ°é€™å€‹å€¼
    music.volume = Number(volume.value);
});

// é€²åº¦æ¢æ‹–æ›³
progress.addEventListener("input", () => {
    if(!music.duration) return;
    isSeeking = true;
    const t = (Number(progress.value) / 100) * music.duration;
    curTime.textContent = fmt(t); // æ‹–æ›³æ™‚åŒæ­¥é¡¯ç¤ºæ™‚é–“
});

progress.addEventListener("change", () => {
    if(!music.duration) return;
    const t = (Number(progress.value) / 100) * music.duration;
    music.currentTime = t;
    isSeeking = false;
});

// âœ… timeupdateï¼šæ›´æ–°å­—å¹• + é€²åº¦æ¢ + ç•¶å‰æ™‚é–“
music.addEventListener("timeupdate", () => {
    if(isPlaying) updateSubtitle(music.currentTime);

    if(!music.duration) return;

    // é¿å…ä½¿ç”¨è€…æ­£åœ¨æ‹–æ›³æ™‚è¢« timeupdate æŠ¢å›žåŽ»
    if(!isSeeking){
        const p = (music.currentTime / music.duration) * 100;
        progress.value = p;
    }
    curTime.textContent = fmt(music.currentTime);
});

// âœ… æ’­æ”¾çµæŸï¼Œå¾©åŽŸç‹€æ…‹
music.addEventListener("ended", () => {
    isPlaying = false;
    btn.classList.remove("is-on");
    btn.classList.add("is-off");
    subtitleBox.classList.add("hidden");
    progress.value = 0;
    curTime.textContent = "0:00";
});

// æ·¡å…¥æ·¡å‡ºï¼ˆæ”¹æˆæ·¡å…¥åˆ°ã€ŒéŸ³é‡æ¢å€¼ã€ï¼Œä¸æ˜¯å›ºå®š 1ï¼‰
function fadeIn(){
    const target = Number(volume.value);
    music.volume = 0;
    let v = 0;
    const i = setInterval(() => {
        v += 0.05;
        if(v >= target){
            v = target;
            clearInterval(i);
        }
        music.volume = v;
    }, 60);
}

function fadeOut(){
    let v = music.volume;
    const i = setInterval(() => {
        v -= 0.05;
        if(v <= 0){
            v = 0;
            clearInterval(i);
            music.pause();
        }
        music.volume = v;
    }, 60);
}

btn.addEventListener("click", async () => {
    if(!isPlaying){
        try{
            await music.play();
            fadeIn();
            isPlaying = true;
            btn.classList.remove("is-off");
            btn.classList.add("is-on");
        }catch(e){
            console.log("Play blocked:", e);
        }
    }else{
        fadeOut();
        isPlaying = false;
        btn.classList.remove("is-on");
        btn.classList.add("is-off");
        subtitleBox.classList.add("hidden");
    }
});
</script>

</body>
</html>
